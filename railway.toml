[build]
builder = "nixpacks"

[deploy]
startCommand = "npm start"
healthcheckPath = "/"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[variables]
NPM_CONFIG_PACKAGE_MANAGER = "npm"
NPM_CONFIG_LEGACY_PEER_DEPS = "true"

# Frontend Service
[[services]]
name = "frontend"
sourceDir = "."
buildCommand = "npm install --legacy-peer-deps && npm run build"
startCommand = "npm start"
healthcheckPath = "/"
healthcheckTimeout = 100

# ML Server Service
[[services]]
name = "ml-server"
sourceDir = "scripts"
buildCommand = "python3 -m venv /app/venv && /app/venv/bin/pip install --upgrade pip && /app/venv/bin/pip install --only-binary=all -r ../requirements-simple.txt"
startCommand = "/app/venv/bin/python ml-integration-example.py"
healthcheckPath = "/health"
healthcheckTimeout = 100

# Hope AI Service
[[services]]
name = "hope-ai"
sourceDir = "scripts"
buildCommand = "python3 -m venv /app/venv && /app/venv/bin/pip install --upgrade pip && /app/venv/bin/pip install --only-binary=all -r ../requirements-simple.txt"
startCommand = "/app/venv/bin/python Hope.py"
healthcheckPath = "/health"
healthcheckTimeout = 100 